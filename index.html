<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>å‡ªç ‚ãã‚“ã‚¯ãƒªãƒƒã‚«ãƒ¼</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to bottom, #8d6e63, #5d4037);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      color: #fff;
      position: relative;
      overflow-x: hidden;
    }
    .bg-decoration { position: fixed; pointer-events: none; opacity: 0.15; z-index: 0; }
    .bg-emoji { font-size: 3rem; animation: float 6s ease-in-out infinite; }
    .bg-shape { border-radius: 50%; background: rgba(255, 255, 255, 0.1); animation: float 8s ease-in-out infinite; }
    @keyframes float { 0%,100%{transform:translateY(0) rotate(0)} 50%{transform:translateY(-20px) rotate(5deg)} }

    h1, .main-container { position: relative; z-index: 1; }
    h1 { font-size: 1.2rem; margin-bottom: .5rem; color:#ffecb3; text-shadow: 2px 2px 4px rgba(0,0,0,.5);}

    .main-container { display:flex; gap:.5rem; max-width:1200px; width:100%; flex-wrap:wrap; }
    .left-section { flex:1; min-width:280px; display:flex; flex-direction:column; gap:.5rem; }
    .right-section { width:280px; display:flex; flex-direction:column; gap:.5rem; }

    @media (max-width:768px){
      .main-container { flex-direction:column; }
      .right-section { width:100%; }
      h1 { font-size:1.25rem; }
    }

    .stats-area,.shop-area,.collection-area,.achievements-area{
      background:rgba(255,255,255,.1); backdrop-filter: blur(10px);
      padding:.75rem; border-radius:.75rem; box-shadow:0 4px 6px rgba(0,0,0,.3);
    }
    .achievements-area {
      min-height: 160px;
      max-height: 320px;
      overflow-y: auto;
    }
    .achievement-card {
      will-change: transform;
    }
    .stat-item{ display:flex; justify-content:space-between; margin-bottom:.5rem; font-size:.875rem;}
    .stat-label{ color:#ffe082; font-size:.75rem;}
    .stat-value{ color:#ffecb3; font-weight:bold; font-size:.875rem;}
    
    /* åŒ—æ¥µãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç”¨ã®æš—ã„è‰² */
    body[data-field="arctic"] .stat-label,
    body[data-field="arctic"] .stat-value,
    body[data-field="arctic"] .shop-title,
    body[data-field="arctic"] .collection-title,
    body[data-field="arctic"] .achievements-title,
    body[data-field="arctic"] .shop-item-name,
    body[data-field="arctic"] .shop-item-desc,
    body[data-field="arctic"] .shop-item-cost,
    body[data-field="arctic"] .shop-item-owned,
    body[data-field="arctic"] .item-name,
    body[data-field="arctic"] .item-count,
    body[data-field="arctic"] .achievement-item,
    body[data-field="arctic"] #field-container button {
      color: #1a237e !important;
    }
    
    body[data-field="arctic"] .collection-item {
      color: #1a237e !important;
    }
    
    body[data-field="arctic"] .achievement-item.unlocked {
      color: #1a237e !important;
      border-color: #1a237e !important;
    }



    .excavation-area{
      background:rgba(255,255,255,.1); backdrop-filter:blur(10px);
      padding:1rem; border-radius:.75rem; box-shadow:0 4px 6px rgba(0,0,0,.3);
      display:flex; flex-direction:column; align-items:center; gap:.5rem;
      position:relative; min-height:350px; overflow:hidden; cursor:pointer;
    }
    @media (max-width:768px){ .excavation-area{ min-height:300px; } }

    .field-background{ position:absolute; inset:0;
      background:linear-gradient(to bottom, rgba(141,110,99,.3), rgba(93,64,55,.8)); transition:background .5s; }

    .character{ position:absolute; transition:all 0.8s ease-in-out; z-index:10; width:150px; height:150px;}
    .character.moving{ transition:all 0.5s ease-in-out; }

    .dialogue{
      background:rgba(255,255,255,.2); backdrop-filter:blur(10px);
      padding:.75rem 1rem; border-radius:1rem; color:#ffecb3; font-size:.875rem; min-height:2.5rem;
      display:flex; align-items:center; justify-content:center; max-width:300px;
    }

    .character.digging{ animation:digAnimation .4s; }
    @keyframes digAnimation{
      0%,100%{ transform:translateX(-50%) translateY(-50%); }
      25%{ transform:translateX(-50%) translateY(calc(-50% + 3px)) rotate(-3deg); }
      75%{ transform:translateX(-50%) translateY(calc(-50% + 3px)) rotate(3deg); }
    }

    .dig-hole{ position:absolute; width:80px; height:40px; background: radial-gradient(ellipse, rgba(0,0,0,.6), transparent);
      border-radius:50%; pointer-events:none; animation:digHoleAppear .5s ease-out; z-index:1;}
    @keyframes digHoleAppear{ 0%{transform:scale(0);opacity:0} 50%{transform:scale(1.2);opacity:1} 100%{transform:scale(1);opacity:.7} }

    .golden-artifact{ position:absolute; width:60px; height:60px; font-size:3rem; cursor:pointer; z-index:20;
      animation: goldenFloat 2s ease-in-out infinite, goldenGlow 1.5s ease-in-out infinite;
      filter: drop-shadow(0 0 10px gold); transition: transform .1s;}
    .golden-artifact:hover{ transform:scale(1.2); }
    @keyframes goldenFloat{ 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
    @keyframes goldenGlow{ 0%,100%{filter: drop-shadow(0 0 10px gold)} 50%{filter: drop-shadow(0 0 20px gold) drop-shadow(0 0 30px orange)} }

    .dig-effect{ position:absolute; color:#8d6e63; font-size:1.5rem; pointer-events:none; animation:digEffectFloat .8s ease-out forwards; z-index:5;}
    @keyframes digEffectFloat{ 0%{transform:translateY(0) scale(1);opacity:1} 100%{transform:translateY(-50px) scale(.5);opacity:0} }

    .field-info{ position:absolute; top:1rem; left:50%; transform:translateX(-50%); font-size:1.5rem; color:#ffecb3;
      text-shadow:2px 2px 4px rgba(0,0,0,.5); z-index:10; }

    .click-effect{ position:absolute; color:#ffecb3; font-weight:bold; font-size:1.5rem; pointer-events:none; animation:floatUp 1s ease-out forwards; }
    @keyframes floatUp{ 0%{opacity:1;transform:translateY(0)} 100%{opacity:0;transform:translateY(-100px)} }

    .found-item{
      background: rgba(255,235,59,.2); border:2px solid #ffeb3b; padding:.5rem 1rem; border-radius:.5rem;
      font-size:1.0rem; animation:itemPop .5s ease-out; min-height:2.4rem; display:flex; align-items:center; justify-content:center;
    }
    @keyframes itemPop{ 0%{ transform:scale(0); opacity:0;} 50%{ transform:scale(1.2);} 100%{ transform:scale(1); opacity:1;} }

    .shop-title,.collection-title,.achievements-title{ font-size:1rem; color:#ffecb3; margin-bottom:.75rem; text-align:center; }
    .shop-item{ background:rgba(255,255,255,.1); padding:.5rem; border-radius:.4rem; margin-bottom:.5rem; border:2px solid transparent; transition:all .2s;}
    .shop-item:hover{ background:rgba(255,255,255,.2); border-color:#ffeb3b;}
    .shop-item.disabled{ opacity:.5; cursor:not-allowed;}
    .shop-item:not(.disabled){ cursor:pointer;}
    .shop-item-name{ font-weight:bold; color:#ffecb3; margin-bottom:.2rem; font-size:.8rem;}
    .shop-item-desc{ font-size:.7rem; color:#ffe082; margin-bottom:.2rem;}
    .shop-item-cost{ color:#fff176; font-size:.7rem;}
    .shop-item-owned{ color:#81c784; font-size:.65rem;}
    .shop-upgrade-icons{ display:flex; flex-wrap:wrap; gap:.2rem; margin-top:.4rem; min-height:1.2rem; }
    .shop-upgrade-icon{ font-size:1rem; opacity:.9; animation:iconPop .3s ease-out; }
    @keyframes iconPop{ 0%{transform:scale(0);opacity:0} 50%{transform:scale(1.2)} 100%{transform:scale(1);opacity:.9} }

    .collection-area{ max-height:300px; overflow-y:auto; }
    .collection-item{ background:rgba(255,255,255,.1); padding:.4rem; border-radius:.4rem; margin-bottom:.4rem; display:flex; justify-content:space-between; align-items:center;}
    .collection-item.common{ border-left:3px solid #bdbdbd; }
    .collection-item.rare{ border-left:3px solid #64b5f6; }
    .collection-item.epic{ border-left:3px solid #ba68c8; }
    .collection-item.legendary{ border-left:3px solid #ffd54f; }
    .item-name{ color:#ffecb3; font-size:.75rem;}
    .item-count{ color:#ffe082; font-size:.7rem;}

    .tab-buttons{ display:flex; gap:.5rem; margin-bottom:.75rem; }
    .tab-button{ flex:1; padding:.5rem; background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.2);
      border-radius:.4rem; color:#ffecb3; cursor:pointer; transition:.2s; font-size:.75rem; }
    .tab-button.active{ background:rgba(255,235,59,.3); border-color:#ffeb3b; }
    .tab-button:hover:not(.active){ background:rgba(255,255,255,.2); }

    .gallery-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:.5rem; }
    .gallery-item{ background:rgba(255,255,255,.1); padding:.5rem; border-radius:.4rem; text-align:center; cursor:pointer;
      transition:.2s; border:2px solid transparent; min-height:85px; display:flex; flex-direction:column; align-items:center; justify-content:center; }
    .gallery-item:hover{ background:rgba(255,255,255,.2); transform:translateY(-2px); }
    .gallery-item.legendary{ border-color:#ffd54f; background:linear-gradient(135deg, rgba(255,213,79,.2), rgba(255,255,255,.1)); animation:shimmer 2s infinite; }
    @keyframes shimmer{ 0%,100%{ box-shadow:0 0 5px rgba(255,213,79,.3)} 50%{ box-shadow:0 0 15px rgba(255,213,79,.6)} }
    .gallery-item.locked{ opacity:.4; filter:grayscale(100%); cursor:default; }
    .gallery-item.locked:hover{ transform:none; background:rgba(255,255,255,.1); }
    .gallery-emoji{ font-size:2rem; margin-bottom:.25rem; }
    .gallery-name{ font-size:.65rem; color:#ffecb3; margin-bottom:.1rem; }
    .gallery-count{ font-size:.6rem; color:#ffe082; }
    .gallery-stage-header{ color:#ffecb3; font-size:.85rem; margin:.75rem 0 .5rem; padding-bottom:.25rem; border-bottom:1px solid rgba(255,255,255,.2); }
    .gallery-stage-header.locked{ color:#ccc; }

    .ach-item{ background:rgba(255,255,255,.08); padding:.45rem; border-radius:.45rem; margin-bottom:.4rem; border:2px dashed rgba(255,255,255,.15);
      display:flex; gap:.5rem; align-items:center; justify-content:space-between; font-size:.75rem; }
    .ach-item.unlocked{ border-style:solid; border-color:#ffd54f; background:rgba(255,235,59,.12); }
    .ach-left{ display:flex; gap:.5rem; align-items:center;}
    .ach-badge{ font-size:1rem; }
    .ach-name{ color:#ffecb3; font-weight:bold; }
    .ach-desc{ color:#ffe082; font-size:.7rem; }

    .toast{ position:fixed; bottom:16px; left:50%; transform:translateX(-50%);
      background:rgba(255,235,59,.15); border:1px solid #ffeb3b; color:#ffecb3; padding:.5rem .75rem; border-radius:.5rem;
      box-shadow:0 4px 12px rgba(0,0,0,.4); z-index:9999; font-size:.85rem; animation:toastPop .25s ease-out; }
    @keyframes toastPop{ from{transform:translateX(-50%) scale(.9); opacity:0} to{transform:translateX(-50%) scale(1); opacity:1} }
  </style>
</head>
<body>
  <!-- èƒŒæ™¯è£…é£¾ -->
  <div class="bg-decoration bg-emoji" style="top: 10%; left: 5%; animation-delay: 0s;">â›°ï¸</div>
  <div class="bg-decoration bg-emoji" style="top: 15%; right: 8%; animation-delay: 1s;">ğŸ”ï¸</div>
  <div class="bg-decoration bg-emoji" style="top: 40%; left: 10%; animation-delay: 2s;">â­</div>
  <div class="bg-decoration bg-emoji" style="top: 60%; right: 5%; animation-delay: 1.5s;">ğŸŒŸ</div>
  <div class="bg-decoration bg-emoji" style="top: 80%; left: 15%; animation-delay: 0.5s;">ğŸ”º</div>
  <div class="bg-decoration bg-emoji" style="top: 25%; right: 15%; animation-delay: 2.5s;">ğŸ’</div>
  <div class="bg-decoration bg-emoji" style="top: 70%; left: 3%; animation-delay: 3s;">ğŸ—»</div>
  <div class="bg-decoration bg-emoji" style="top: 50%; right: 12%; animation-delay: 1s;">âœ¨</div>
  <div class="bg-decoration bg-shape" style="top: 20%; left: 50%; width: 60px; height: 60px; animation-delay: 2s;"></div>
  <div class="bg-decoration bg-shape" style="top: 65%; left: 70%; width: 40px; height: 40px; animation-delay: 1s;"></div>
  <div class="bg-decoration bg-shape" style="top: 35%; left: 25%; width: 50px; height: 50px; animation-delay: 3s;"></div>

  <h1>â›ï¸ å‡ªç ‚ãã‚“ã‚¯ãƒªãƒƒã‚«ãƒ¼</h1>

  <div class="main-container">
    <div class="left-section">
      <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
      <div class="stats-area">
        <div class="stat-item"><span class="stat-label">ç™ºæ˜ãƒã‚¤ãƒ³ãƒˆ</span><span class="stat-value" id="points">0</span></div>
        <div class="stat-item"><span class="stat-label">1ã‚¯ãƒªãƒƒã‚¯ã®ç™ºæ˜é‡</span><span class="stat-value" id="click-power">1</span></div>
        <div class="stat-item"><span class="stat-label">è‡ªå‹•ç™ºæ˜/ç§’</span><span class="stat-value" id="auto-power">0</span></div>
        <div class="stat-item"><span class="stat-label">ç·ç™ºæ˜å›æ•°</span><span class="stat-value" id="total-digs">0</span></div>
        <div class="stat-item"><span class="stat-label">ç´¯è¨ˆç²å¾—ãƒã‚¤ãƒ³ãƒˆ</span><span class="stat-value" id="total-earned">0</span></div>
      </div>

      <!-- ç™ºæ˜ã‚¨ãƒªã‚¢ -->
      <div class="excavation-area" id="excavation-area">
        <div class="field-background" id="field-background"></div>
        <div class="field-info" id="current-field-name" style="font-size:.9rem; top:.4rem;">ğŸŒ± è‰åŸ</div>

        <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ -->
        <div class="character" id="character">
          <img id="char-sprite" src="" alt="å‡ªç ‚" style="width:180px; height:auto; image-rendering: smooth;">
        </div>

        <!-- ã‚»ãƒªãƒ• -->
        <div class="dialogue" id="dialogue" style="position:absolute; bottom:2.5rem; left:50%; transform:translateX(-50%); z-index:10; padding:.4rem .6rem; font-size:.7rem; min-height:1.8rem; max-width:220px;">â€¦</div>
        <div class="found-item" id="found-item" style="visibility:hidden; position:absolute; bottom:.75rem; left:50%; transform:translateX(-50%); z-index:10; padding:.35rem .6rem; font-size:.8rem; min-height:1.8rem;">ä½•ã‚‚è¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸ</div>
      </div>

      <!-- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é¸æŠ -->
      <div class="stats-area">
        <div style="font-size:.875rem; color:#ffecb3; margin-bottom:.5rem; text-align:center;">ğŸŒ ç™ºæ˜å ´æ‰€</div>
        <div id="field-container" style="display:flex; flex-direction:column; gap:.4rem;"></div>
      </div>
    </div>

    <div class="right-section">
      <!-- ã‚·ãƒ§ãƒƒãƒ— -->
      <div class="shop-area">
        <div class="shop-title">âš™ï¸ ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</div>
        <div id="shop-container"></div>
      </div>

      <!-- ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="collection-area">
        <div class="tab-buttons">
          <button class="tab-button active" id="list-tab">ãƒªã‚¹ãƒˆ</button>
          <button class="tab-button" id="gallery-tab">å›³é‘‘</button>
        </div>
        <div class="collection-title">ğŸº ç™ºè¦‹ã—ãŸéºç‰©</div>
        <div id="collection-container"></div>
      </div>

      <!-- å®Ÿç¸¾ -->
      <div class="achievements-area">
        <div class="achievements-title">ğŸ† å®Ÿç¸¾</div>
        <div id="achievements-container"></div>
      </div>
    </div>
  </div>

  <!-- ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ -->
  <div style="margin-top: 1.5rem; width: 100%; max-width: 400px; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 1rem; border-radius: 0.75rem; text-align: center;">
    <div style="color: #ffe082; font-size: 0.75rem; line-height: 1.6;">
      åˆ¶ä½œï¼šã—ã‚‡ã†ã§ã‚“@cakecore1mb<br>
      äºŒæ¬¡å‰µä½œä½œå“ã§ã™ã€‚ã‚ã‚“ã•ã‚“ã¶ã‚‹ã‚¹ã‚¿ãƒ¼ã‚º!!å…¬å¼æ§˜ã¨ã¯ä¸€åˆ‡é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
      èª•ç”Ÿæ—¥è¨˜å¿µã®ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ãªã®ã§ã€ãƒãƒ©ãƒ³ã‚¹èª¿æ•´ãƒ»ãƒ‡ãƒãƒƒã‚°ã¯å®Œå…¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã”äº†æ‰¿ãã ã•ã„ã€‚<br>
      åˆ¶ä½œè€…ã¯ä¸€åˆ‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ã¾ã›ã‚“ã€‚<br>
      ãƒªãƒªãƒ¼ã‚¹æ—¥ï¼š2025å¹´10æœˆ27æ—¥<br>
      å‡ªç ‚ãã‚“ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ğŸ‚ğŸ«
    </div>
  </div>

  <!-- ãƒªã‚»ãƒƒãƒˆ -->
  <div style="margin-top: 1rem; width: 100%; max-width: 300px;">
    <button id="reset-btn" style="
      width: 100%; padding: .5rem; background: rgba(244,67,54,.3); color:#ffcdd2;
      border:1px solid #ef5350; border-radius:.5rem; cursor:pointer; font-size:.8rem; transition:all .2s;"
      onmouseover="this.style.background='rgba(244,67,54,0.5)'" onmouseout="this.style.background='rgba(244,67,54,0.3)'">
      ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
    </button>
  </div>

  <script>
    /*** ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒãƒ‡ãƒ¼ã‚¿ ***/
    // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã¯ images/ ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã—ã¦ãã ã•ã„
    const characterImages = {
      grassland: {
        idle: "images/grassland_idle.png",
        blink: "images/grassland_blink.png",
        digDown: "images/grassland_digDown.png",
        digUp: "images/grassland_digUp.png"
      },
      desert: {
        idle: "images/desert_idle.png",
        blink: "images/desert_blink.png",
        digDown: "images/desert_digDown.png",
        digUp: "images/desert_digUp.png"
      },
      ruins: {
        idle: "images/ruins_idle.png",
        blink: "images/ruins_blink.png",
        digDown: "images/ruins_digDown.png",
        digUp: "images/ruins_digUp.png"
      },
      arctic: {
        idle: "images/arctic_idle.png",
        blink: "images/arctic_blink.png",
        digDown: "images/arctic_digDown.png",
        digUp: "images/arctic_digUp.png"
      },
      ocean: {
        idle: "images/ocean_idle.png",
        blink: "images/ocean_blink.png",
        digDown: "images/ocean_digDown.png",
        digUp: "images/ocean_digUp.png"
      },
      cave: {
        idle: "images/cave_idle.png",
        blink: "images/cave_blink.png",
        digDown: "images/cave_digDown.png",
        digUp: "images/cave_digUp.png"
      },
      library: {
        idle: "images/library_idle.png",
        blink: "images/library_blink.png",
        digDown: "images/library_digDown.png",
        digUp: "images/library_digUp.png"
      },
      moon: {
        idle: "images/moon_idle.png",
        blink: "images/moon_blink.png",
        digDown: "images/moon_digDown.png",
        digUp: "images/moon_digUp.png"
      },
      mars: {
        idle: "images/mars_idle.png",
        blink: "images/mars_blink.png",
        digDown: "images/mars_digDown.png",
        digUp: "images/mars_digUp.png"
      }
    };


    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    function playDigSound(){ const osc=audioContext.createOscillator(),g=audioContext.createGain();osc.connect(g);g.connect(audioContext.destination);osc.frequency.value=300;osc.type='sine';g.gain.setValueAtTime(0.25,audioContext.currentTime);g.gain.exponentialRampToValueAtTime(0.01,audioContext.currentTime+0.1);osc.start();osc.stop(audioContext.currentTime+0.1); }
    function playPurchaseSound(){ const o=audioContext.createOscillator(),g=audioContext.createGain();o.connect(g);g.connect(audioContext.destination);o.type='triangle';o.frequency.setValueAtTime(400,audioContext.currentTime);o.frequency.setValueAtTime(600,audioContext.currentTime+0.05);g.gain.setValueAtTime(0.2,audioContext.currentTime);g.gain.exponentialRampToValueAtTime(0.01,audioContext.currentTime+0.15);o.start();o.stop(audioContext.currentTime+0.15); }
    function playGoldenSound(){ 
      // ã‚­ãƒ©ã‚­ãƒ©ã—ãŸ3é‡å’ŒéŸ³
      [800, 1000, 1200].forEach((freq,i)=>{
        const o=audioContext.createOscillator(),g=audioContext.createGain();
        o.connect(g);g.connect(audioContext.destination);
        o.type='sine';
        o.frequency.setValueAtTime(freq,audioContext.currentTime+i*0.08);
        g.gain.setValueAtTime(0.15,audioContext.currentTime+i*0.08);
        g.gain.exponentialRampToValueAtTime(0.01,audioContext.currentTime+i*0.08+0.3);
        o.start(audioContext.currentTime+i*0.08);
        o.stop(audioContext.currentTime+i*0.08+0.3);
      });
    }

    let points=0,totalPointsEarned=0,clickPower=1,autoPower=0,totalDigs=0,rareBonus=0,currentField='grassland',goldenArtifactActive=false,currentTab='list',charX=50,charY=50,prevCharX=50,isDigging=false,wanderInterval=null,lastDigTime=0,idleTimeout=null;
    const upgrades={shovel:0,autoDigger:0,detector:0,team:0,lab:0},collection={};
    const achievementsDef=[{id:'first_dig',name:'åˆæ˜ã‚Š',desc:'åˆã‚ã¦ç™ºæ˜ã™ã‚‹',unlocked:false},{id:'dig_100',name:'æ˜å‰Šè·äºº',desc:'ç·ç™ºæ˜å›æ•°ãŒ100å›',unlocked:false},{id:'first_rare',name:'è¼ãã®äºˆæ„Ÿ',desc:'åˆã‚ã¦ãƒ¬ã‚¢ä»¥ä¸Šã‚’ç™ºè¦‹',unlocked:false},{id:'first_epic',name:'æ­´å²çš„ä¸€æ­©',desc:'åˆã‚ã¦ã‚¨ãƒ”ãƒƒã‚¯ã‚’ç™ºè¦‹',unlocked:false},{id:'first_legend',name:'å¥‡è·¡ã®ç›®æ’ƒè€…',desc:'åˆã‚ã¦ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰ã‚’ç™ºè¦‹',unlocked:false},{id:'unlock_2',name:'æ—…ç«‹ã¡',desc:'ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’2ã‹æ‰€ä»¥ä¸Šè§£ç¦',unlocked:false},{id:'unlock_all',name:'ä¸–ç•Œå¾æœ',desc:'å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è§£ç¦',unlocked:false},{id:'earn_1k',name:'å°é‡‘æŒã¡',desc:'ç´¯è¨ˆ1,000ãƒã‚¤ãƒ³ãƒˆç²å¾—',unlocked:false},{id:'earn_10k',name:'ç™ºæ˜ç‹',desc:'ç´¯è¨ˆ10,000ãƒã‚¤ãƒ³ãƒˆç²å¾—',unlocked:false},{id:'earn_50k',name:'éºè·¡ã®è¦‡è€…',desc:'ç´¯è¨ˆ50,000ãƒã‚¤ãƒ³ãƒˆç²å¾—',unlocked:false},{id:'earn_100k',name:'ä¼èª¬ã®æ¢æ¤œå®¶',desc:'ç´¯è¨ˆ100,000ãƒã‚¤ãƒ³ãƒˆç²å¾—',unlocked:false},{id:'earn_500k',name:'ç¥è©±ç´šã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼',desc:'ç´¯è¨ˆ500,000ãƒã‚¤ãƒ³ãƒˆç²å¾—',unlocked:false},{id:'earn_1m',name:'ç™ºæ˜ã®ç¥',desc:'ç´¯è¨ˆ1,000,000ãƒã‚¤ãƒ³ãƒˆç²å¾—',unlocked:false},{id:'complete_grassland',name:'è‰åŸãƒã‚¹ã‚¿ãƒ¼',desc:'è‰åŸã®å…¨ã‚¢ã‚¤ãƒ†ãƒ ç™ºè¦‹',unlocked:false},{id:'complete_desert',name:'ç ‚æ¼ ãƒã‚¹ã‚¿ãƒ¼',desc:'ç ‚æ¼ ã®å…¨ã‚¢ã‚¤ãƒ†ãƒ ç™ºè¦‹',unlocked:false},{id:'complete_ruins',name:'éƒ½å¸‚ãƒã‚¹ã‚¿ãƒ¼',desc:'éƒ½å¸‚éºè·¡ã®å…¨ã‚¢ã‚¤ãƒ†ãƒ ç™ºè¦‹',unlocked:false},{id:'complete_arctic',name:'åŒ—æ¥µãƒã‚¹ã‚¿ãƒ¼',desc:'åŒ—æ¥µã®å…¨ã‚¢ã‚¤ãƒ†ãƒ ç™ºè¦‹',unlocked:false},{id:'complete_ocean',name:'æµ·åº•ãƒã‚¹ã‚¿ãƒ¼',desc:'æµ·åº•ã®å…¨ã‚¢ã‚¤ãƒ†ãƒ ç™ºè¦‹',unlocked:false},{id:'complete_cave',name:'æ´çªŸãƒã‚¹ã‚¿ãƒ¼',desc:'æ´çªŸã®å…¨ã‚¢ã‚¤ãƒ†ãƒ ç™ºè¦‹',unlocked:false},{id:'complete_library',name:'å›³æ›¸é¤¨ãƒã‚¹ã‚¿ãƒ¼',desc:'å¤ä»£å›³æ›¸é¤¨ã®å…¨ã‚¢ã‚¤ãƒ†ãƒ ç™ºè¦‹',unlocked:false},{id:'complete_moon',name:'æœˆé¢ãƒã‚¹ã‚¿ãƒ¼',desc:'æœˆé¢ã®å…¨ã‚¢ã‚¤ãƒ†ãƒ ç™ºè¦‹',unlocked:false},{id:'complete_mars',name:'ç«æ˜Ÿãƒã‚¹ã‚¿ãƒ¼',desc:'ç«æ˜Ÿã®å…¨ã‚¢ã‚¤ãƒ†ãƒ ç™ºè¦‹',unlocked:false},{id:'complete_all',name:'å®Œå…¨åˆ¶è¦‡',desc:'å…¨ã‚¢ã‚¤ãƒ†ãƒ ç™ºè¦‹',unlocked:false}];
    const achievementsState={};achievementsDef.forEach(a=>achievementsState[a.id]={unlocked:false,date:null});

    const pointsEl=document.getElementById('points'),clickPowerEl=document.getElementById('click-power'),autoPowerEl=document.getElementById('auto-power'),totalDigsEl=document.getElementById('total-digs'),totalEarnedEl=document.getElementById('total-earned'),dialogueEl=document.getElementById('dialogue'),excavationAreaEl=document.getElementById('excavation-area'),characterEl=document.getElementById('character'),charSpriteEl=document.getElementById('char-sprite'),fieldBackgroundEl=document.getElementById('field-background'),foundItemEl=document.getElementById('found-item'),shopContainerEl=document.getElementById('shop-container'),collectionContainerEl=document.getElementById('collection-container'),achievementsContainerEl=document.getElementById('achievements-container'),listTabEl=document.getElementById('list-tab'),galleryTabEl=document.getElementById('gallery-tab');

    const fields={grassland:{name:'è‰åŸ',emoji:'ğŸŒ±',unlockCost:0,unlocked:true,bgGradient:'linear-gradient(to bottom, #8d6e63, #5d4037)',fieldBg:'linear-gradient(to bottom, rgba(141,110,99,0.3), rgba(93,64,55,0.8))',digButton:'#8d6e63',textColor:'#ffecb3',outfit:{body:'linear-gradient(to bottom, #ba68c8, #ab47bc)',hair:'linear-gradient(to bottom, #5e35b1, #673ab7)'},artifacts:{common:[{name:'åœŸ',emoji:'ğŸŸ¤'},{name:'çŸ³ã“ã‚',emoji:'ğŸª¨'},{name:'æœ¨ã®ç ´ç‰‡',emoji:'ğŸªµ'},{name:'è²æ®»',emoji:'ğŸš'}],rare:[{name:'åœŸå™¨ã®ã‹ã‘ã‚‰',emoji:'ğŸº'},{name:'å¤ã„éª¨',emoji:'ğŸ¦´'},{name:'åŒ–çŸ³',emoji:'ğŸ¦•'},{name:'å¤ä»£ã®ã‚³ã‚¤ãƒ³',emoji:'ğŸª™'},{name:'ã‚¢ãƒ¡ã‚¸ã‚¹ãƒˆ',emoji:'ğŸ’œ'},{name:'ãƒ­ãƒ¼ã‚ºã‚¯ã‚©ãƒ¼ãƒ„',emoji:'ğŸ©·'},{name:'ã‚·ãƒˆãƒªãƒ³',emoji:'ğŸŸ¡'},{name:'ãƒšãƒªãƒ‰ãƒƒãƒˆ',emoji:'ğŸ’š'}],epic:[{name:'å®Œå…¨ãªå£º',emoji:'ğŸº'},{name:'æç«œã®åŒ–çŸ³',emoji:'ğŸ¦–'},{name:'å¤ä»£ã®æ­¦å™¨',emoji:'âš”ï¸'}],legendary:[{name:'ç´«è‰²ã®ãƒ˜ãƒ“',emoji:'ğŸ'},{name:'ãƒã‚¤ã‚¨ãƒŠã®å°»å°¾',emoji:'ğŸ¦´'}]}},desert:{name:'ç ‚æ¼ ',emoji:'ğŸœï¸',unlockCost:500,unlocked:false,bgGradient:'linear-gradient(to bottom, #d4a574, #c19a6b)',fieldBg:'linear-gradient(to bottom, rgba(212,165,116,0.3), rgba(193,154,107,0.8))',digButton:'#d4a574',textColor:'#5d4037',outfit:{body:'linear-gradient(to bottom,#ffb74d,#ff9800)',hair:'linear-gradient(to bottom,#f57c00,#e65100)'},artifacts:{common:[{name:'ç ‚',emoji:'â³'},{name:'ã‚µãƒœãƒ†ãƒ³ã®æ£˜',emoji:'ğŸŒµ'},{name:'ä¹¾ã„ãŸéª¨',emoji:'ğŸ¦´'}],rare:[{name:'ã‚¨ã‚¸ãƒ—ãƒˆåœŸå™¨',emoji:'ğŸº'},{name:'ãƒŸã‚¤ãƒ©ã®åŒ…å¸¯',emoji:'ğŸ§»'},{name:'å¤ä»£ã®å£ç”»',emoji:'ğŸ¨'},{name:'ãƒˆãƒ‘ãƒ¼ã‚º',emoji:'ğŸŸ¡'},{name:'ã‚¬ãƒ¼ãƒãƒƒãƒˆ',emoji:'ğŸ”´'},{name:'ã‚¿ã‚¤ã‚¬ãƒ¼ã‚¢ã‚¤',emoji:'ğŸŸ¤'},{name:'ã‚«ãƒ«ã‚»ãƒ‰ãƒ‹ãƒ¼',emoji:'ğŸ¤'}],epic:[{name:'ãƒ•ã‚¡ãƒ©ã‚ªã®ä»®é¢',emoji:'ğŸ‘º'},{name:'ã‚¹ã‚«ãƒ©ãƒ™',emoji:'ğŸª²'},{name:'ãƒ’ã‚¨ãƒ­ã‚°ãƒªãƒ•ã®çŸ³æ¿',emoji:'ğŸ“œ'}],legendary:[{name:'ç ‚æ¼ ã®å®ˆè­·ç¥åƒ',emoji:'ğŸ—¿'}]}},ruins:{name:'éƒ½å¸‚éºè·¡',emoji:'ğŸ™ï¸',unlockCost:2500,unlocked:false,bgGradient:'linear-gradient(to bottom, #607d8b, #455a64)',fieldBg:'linear-gradient(to bottom, rgba(96,125,139,0.3), rgba(69,90,100,0.8))',digButton:'#607d8b',textColor:'#eceff1',outfit:{body:'linear-gradient(to bottom,#78909c,#607d8b)',hair:'linear-gradient(to bottom,#546e7a,#455a64)'},artifacts:{common:[{name:'ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆç‰‡',emoji:'ğŸ§±'},{name:'éŒ†ã³ãŸé‰„',emoji:'ğŸ”©'},{name:'ã‚¬ãƒ©ã‚¹ç‰‡',emoji:'ğŸªŸ'}],rare:[{name:'å¤ã„çœ‹æ¿',emoji:'ğŸª§'},{name:'ãƒã‚ªãƒ³ç®¡',emoji:'ğŸ’¡'},{name:'é‡‘åº«',emoji:'ğŸ”'},{name:'ã‚¢ã‚¤ã‚ªãƒ©ã‚¤ãƒˆ',emoji:'ğŸ’™'},{name:'ã‚¢ãƒ‘ã‚¿ã‚¤ãƒˆ',emoji:'ğŸ’š'},{name:'ãƒ˜ãƒã‚¿ã‚¤ãƒˆ',emoji:'âš«'},{name:'ãƒ­ãƒ¼ãƒ‰ã‚¯ãƒ­ã‚µã‚¤ãƒˆ',emoji:'ğŸ©·'}],epic:[{name:'ã‚¿ã‚¤ãƒ ã‚«ãƒ—ã‚»ãƒ«',emoji:'â³'},{name:'å¤±ã‚ã‚ŒãŸæŠ€è¡“',emoji:'âš™ï¸'},{name:'éƒ½å¸‚ã®è¨˜æ†¶',emoji:'ğŸ’¾'}],legendary:[{name:'æ–‡æ˜ã®éºç”£',emoji:'ğŸ›ï¸'}]}},arctic:{name:'åŒ—æ¥µ',emoji:'ğŸ§Š',unlockCost:6000,unlocked:false,bgGradient:'linear-gradient(to bottom, #b3e5fc, #4fc3f7)',fieldBg:'linear-gradient(to bottom, rgba(179,229,252,0.3), rgba(79,195,247,0.8))',digButton:'#4fc3f7',textColor:'#000000',outfit:{body:'linear-gradient(to bottom,#90caf9,#42a5f5)',hair:'linear-gradient(to bottom,#e3f2fd,#bbdefb)'},artifacts:{common:[{name:'æ°·',emoji:'ğŸ§Š'},{name:'é›ªã®çµæ™¶',emoji:'â„ï¸'},{name:'å‡ã£ãŸé­š',emoji:'ğŸŸ'}],rare:[{name:'ãƒãƒ³ãƒ¢ã‚¹ã®ç‰™',emoji:'ğŸ¦£'},{name:'æ°·æ²³æœŸã®åŒ–çŸ³',emoji:'ğŸ¦´'},{name:'ãƒã‚¤ã‚­ãƒ³ã‚°ã®æ–§',emoji:'ğŸª“'},{name:'ã‚µãƒ•ã‚¡ã‚¤ã‚¢',emoji:'ğŸ”µ'},{name:'ã‚¢ã‚¯ã‚¢ãƒãƒªãƒ³',emoji:'ğŸ’™'},{name:'ãƒ ãƒ¼ãƒ³ã‚¹ãƒˆãƒ¼ãƒ³',emoji:'ğŸ¤'},{name:'ã‚¿ãƒ¼ã‚³ã‚¤ã‚º',emoji:'ğŸ©µ'},{name:'ãƒ©ãƒ”ã‚¹ãƒ©ã‚ºãƒª',emoji:'ğŸ’™'}],epic:[{name:'å‡çµã—ãŸãƒãƒ³ãƒ¢ã‚¹',emoji:'ğŸ¦£'},{name:'å¤ä»£ã®æ°·ã®ç›¾',emoji:'ğŸ›¡ï¸'},{name:'åŒ—æ¥µæ˜Ÿã®æ¬ ç‰‡',emoji:'â­'}],legendary:[{name:'æ°·ã®å¥³ç‹ã®ç‹å† ',emoji:'ğŸ‘‘'}]}},ocean:{name:'æµ·åº•',emoji:'ğŸŒŠ',unlockCost:15000,unlocked:false,bgGradient:'linear-gradient(to bottom, #1565c0, #0d47a1)',fieldBg:'linear-gradient(to bottom, rgba(21,101,192,0.3), rgba(13,71,161,0.8))',digButton:'#1565c0',textColor:'#e3f2fd',outfit:{body:'linear-gradient(to bottom,#26c6da,#0097a7)',hair:'linear-gradient(to bottom,#006064,#004d40)'},artifacts:{common:[{name:'è²æ®»',emoji:'ğŸš'},{name:'ã‚µãƒ³ã‚´',emoji:'ğŸª¸'},{name:'æµ·è—»',emoji:'ğŸŒ¿'}],rare:[{name:'çœŸç ',emoji:'ğŸ“¿'},{name:'æ²ˆæ²¡èˆ¹ã®ç ´ç‰‡',emoji:'âš“'},{name:'å¤ä»£ã®æ°´ä¸­éƒ½å¸‚ã®éºç‰©',emoji:'ğŸ›ï¸'},{name:'ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰',emoji:'ğŸ’š'},{name:'ãƒ’ã‚¹ã‚¤',emoji:'ğŸ’š'},{name:'ã‚ªãƒ‘ãƒ¼ãƒ«',emoji:'ğŸŒˆ'},{name:'ãƒãƒ©ã‚«ã‚¤ãƒˆ',emoji:'ğŸ’š'}],epic:[{name:'ã‚¢ãƒˆãƒ©ãƒ³ãƒ†ã‚£ã‚¹ã®çŸ³æ¿',emoji:'ğŸ“œ'},{name:'æµ·ç¥ã®ä¸‰å‰æ§',emoji:'ğŸ”±'},{name:'äººé­šã®é±—',emoji:'ğŸ§œ'}],legendary:[{name:'ãƒ¡ãƒ³ãƒ€ã‚³',emoji:'ğŸ™'}]}},cave:{name:'æ´çªŸ',emoji:'ğŸ•³ï¸',unlockCost:40000,unlocked:false,bgGradient:'linear-gradient(to bottom, #424242, #212121)',fieldBg:'linear-gradient(to bottom, rgba(66,66,66,0.3), rgba(33,33,33,0.9))',digButton:'#424242',textColor:'#e0e0e0',outfit:{body:'linear-gradient(to bottom,#78909c,#546e7a)',hair:'linear-gradient(to bottom,#37474f,#263238)'},artifacts:{common:[{name:'é¾ä¹³çŸ³',emoji:'ğŸª¨'},{name:'ã‚³ã‚¦ãƒ¢ãƒªã®éª¨',emoji:'ğŸ¦‡'},{name:'å¤ä»£ã®å£ç”»',emoji:'ğŸ¨'}],rare:[{name:'æ°´æ™¶',emoji:'ğŸ’'},{name:'åŸå§‹äººã®é“å…·',emoji:'ğŸ”¨'},{name:'æ´çªŸå£ç”»',emoji:'ğŸ–¼ï¸'},{name:'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰',emoji:'ğŸ’'},{name:'ãƒ«ãƒ“ãƒ¼',emoji:'ğŸ”´'},{name:'ã‚µãƒ³ã‚¹ãƒˆãƒ¼ãƒ³',emoji:'ğŸ§¡'},{name:'ã‚¸ãƒ£ã‚¹ãƒ‘ãƒ¼',emoji:'ğŸŸ¤'},{name:'ã‚ªãƒ‹ã‚­ã‚¹',emoji:'âš«'}],epic:[{name:'å·¨å¤§æ°´æ™¶',emoji:'ğŸ’ '},{name:'ãƒ‰ãƒ©ã‚´ãƒ³ã®éª¨',emoji:'ğŸ‰'},{name:'é­”æ³•ã®æ–',emoji:'ğŸª„'}],legendary:[{name:'ãƒŠã‚®ã‚´ãƒ³ã®åŒ–çŸ³',emoji:'ğŸ¦–'}]}},library:{name:'å¤ä»£å›³æ›¸é¤¨',emoji:'ğŸ“š',unlockCost:80000,unlocked:false,bgGradient:'linear-gradient(to bottom, #6d4c41, #4e342e)',fieldBg:'linear-gradient(to bottom, rgba(109,76,65,0.3), rgba(78,52,46,0.8))',digButton:'#6d4c41',textColor:'#ffecb3',outfit:{body:'linear-gradient(to bottom,#8d6e63,#6d4c41)',hair:'linear-gradient(to bottom,#5d4037,#4e342e)'},artifacts:{common:[{name:'å¤ã„ç´™',emoji:'ğŸ“„'},{name:'ã‚¤ãƒ³ã‚¯ã®æŸ“ã¿',emoji:'ğŸ–‹ï¸'},{name:'åŸƒ',emoji:'ğŸ’¨'}],rare:[{name:'å¤ä»£ã®æ›¸ç‰©',emoji:'ğŸ“–'},{name:'ç¾Šçš®ç´™',emoji:'ğŸ“œ'},{name:'æš—å·æ–‡',emoji:'ğŸ”'},{name:'ã‚¢ãƒ³ãƒãƒ¼',emoji:'ğŸŸ¡'},{name:'ãƒ–ãƒ©ãƒƒãƒ‰ã‚¹ãƒˆãƒ¼ãƒ³',emoji:'ğŸ”´'},{name:'ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ©ã‚¤ãƒˆ',emoji:'ğŸŒˆ'},{name:'ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ã‚¯ã‚©ãƒ¼ãƒ„',emoji:'ğŸŸ¤'}],epic:[{name:'å¤±ã‚ã‚ŒãŸçŸ¥è­˜ã®æ›¸',emoji:'ğŸ“•'},{name:'é­”å°æ›¸',emoji:'ğŸ“˜'},{name:'é è¨€æ›¸',emoji:'ğŸ“™'}],legendary:[{name:'çœŸç†ã®æ›¸',emoji:'ğŸ“—'}]}},moon:{name:'æœˆé¢',emoji:'ğŸŒ™',unlockCost:150000,unlocked:false,bgGradient:'linear-gradient(to bottom, #757575, #424242)',fieldBg:'linear-gradient(to bottom, rgba(117,117,117,0.3), rgba(66,66,66,0.9))',digButton:'#757575',textColor:'#f5f5f5',outfit:{body:'linear-gradient(to bottom,#e0e0e0,#9e9e9e)',hair:'linear-gradient(to bottom,#fafafa,#bdbdbd)'},artifacts:{common:[{name:'æœˆã®çŸ³',emoji:'ğŸŒ‘'},{name:'ãƒ¬ã‚´ãƒªã‚¹',emoji:'ğŸª¨'},{name:'éš•çŸ³ã®ç ´ç‰‡',emoji:'â˜„ï¸'}],rare:[{name:'æœˆã®ã‚¯ãƒ¬ãƒ¼ã‚¿ãƒ¼',emoji:'ğŸ•³ï¸'},{name:'å®‡å®™é£›è¡Œå£«ã®æ——',emoji:'ğŸš©'},{name:'æœˆé¢åŸºåœ°ã®æ®‹éª¸',emoji:'ğŸ—ï¸'},{name:'ã‚¢ãƒ¡ãƒˆãƒªãƒ³',emoji:'ğŸ’œ'},{name:'ã‚¿ãƒ³ã‚¶ãƒŠã‚¤ãƒˆ',emoji:'ğŸ’™'},{name:'ã‚¢ãƒ¬ã‚­ã‚µãƒ³ãƒ‰ãƒ©ã‚¤ãƒˆ',emoji:'ğŸ’œ'},{name:'ã‚¹ãƒ”ãƒãƒ«',emoji:'ğŸ”´'}],epic:[{name:'æœˆã®æ¬ ç‰‡',emoji:'ğŸŒ™'},{name:'ã‚¨ã‚¤ãƒªã‚¢ãƒ³ã®éºç‰©',emoji:'ğŸ‘½'},{name:'æœªçŸ¥ã®é‡‘å±',emoji:'âš™ï¸'}],legendary:[{name:'ãƒ†ã‚£ãƒ¼ã‚»ãƒƒãƒˆ',emoji:'ğŸ«–'},{name:'èŒé»„è‰²ã®ç€ç‰©',emoji:'ğŸ‘˜'}]}},mars:{name:'ç«æ˜Ÿ',emoji:'ğŸ”´',unlockCost:300000,unlocked:false,bgGradient:'linear-gradient(to bottom, #d84315, #bf360c)',fieldBg:'linear-gradient(to bottom, rgba(216,67,21,0.3), rgba(191,54,12,0.8))',digButton:'#d84315',textColor:'#ffccbc',outfit:{body:'linear-gradient(to bottom,#ff7043,#f4511e)',hair:'linear-gradient(to bottom,#d84315,#bf360c)'},artifacts:{common:[{name:'èµ¤ã„ç ‚',emoji:'ğŸ”´'},{name:'ç«æ˜Ÿã®çŸ³',emoji:'ğŸª¨'},{name:'é…¸åŒ–é‰„',emoji:'ğŸŸ¤'}],rare:[{name:'ç«æ˜Ÿã®ã‚¯ãƒ¬ãƒ¼ã‚¿ãƒ¼',emoji:'ğŸ•³ï¸'},{name:'ãƒ­ãƒ¼ãƒãƒ¼ã®ç ´ç‰‡',emoji:'ğŸ¤–'},{name:'æ°´ã®ç—•è·¡',emoji:'ğŸ’§'},{name:'ãƒˆãƒ«ãƒãƒªãƒ³',emoji:'ğŸŒˆ'},{name:'ã‚¸ãƒ«ã‚³ãƒ³',emoji:'ğŸ’'},{name:'ã‚¯ãƒªã‚½ãƒ™ãƒªãƒ«',emoji:'ğŸŸ¡'},{name:'ãƒ•ãƒ­ãƒ¼ãƒ©ã‚¤ãƒˆ',emoji:'ğŸ’œ'}],epic:[{name:'ç«æ˜Ÿäººã®éºç‰©',emoji:'ğŸ‘½'},{name:'å¤ä»£ç«æ˜Ÿæ–‡æ˜ã®éºè·¡',emoji:'ğŸ›ï¸'},{name:'ãƒ†ãƒ©ãƒ•ã‚©ãƒ¼ãƒŸãƒ³ã‚°è£…ç½®',emoji:'ğŸ”§'}],legendary:[{name:'ãƒ¡ãƒ³ãƒ€ã‚³æ˜Ÿäºº',emoji:'ğŸ‘¾'}]}}};

    const upgradeData=[{id:'shovel',name:'ğŸ”¨ ã‚·ãƒ£ãƒ™ãƒ«å¼·åŒ–',desc:'ã‚¯ãƒªãƒƒã‚¯ç™ºæ˜é‡ +1',baseCost:10,costMultiplier:1.45,icon:'ğŸ”¨',effect:()=>{clickPower+=1;}},{id:'autoDigger',name:'ğŸ¤– è‡ªå‹•ç™ºæ˜æ©Ÿ',desc:'æ¯ç§’è‡ªå‹•ç™ºæ˜ +0.5',baseCost:60,costMultiplier:1.7,icon:'ğŸ¤–',effect:()=>{autoPower+=0.5;}},{id:'detector',name:'ğŸ“¡ æ¢çŸ¥æ©Ÿ',desc:'ãƒ¬ã‚¢å‡ºç¾ç‡ +1%',baseCost:120,costMultiplier:1.9,icon:'ğŸ“¡',effect:()=>{rareBonus+=1;}},{id:'team',name:'ğŸ‘¥ ç™ºæ˜ãƒãƒ¼ãƒ ',desc:'æ¯ç§’è‡ªå‹•ç™ºæ˜ +2',baseCost:700,costMultiplier:2.4,icon:'ğŸ‘¥',effect:()=>{autoPower+=2;}},{id:'lab',name:'ğŸ›ï¸ ç ”ç©¶æ‰€',desc:'ç™ºæ˜é€Ÿåº¦2å€ï¼ˆã‚¯ãƒªãƒƒã‚¯/è‡ªå‹•ï¼‰',baseCost:4000,costMultiplier:2.8,icon:'ğŸ›ï¸',effect:()=>{clickPower*=2;autoPower*=2;}}];

    function addPoints(n){const v=Math.max(0,Number(n)||0);points+=v;totalPointsEarned+=v;}
    function spendPoints(n){const v=Math.max(0,Number(n)||0);points=Math.max(0,points-v);}

    function getTrustLevel(){if(totalPointsEarned>=1000000)return 5;if(totalPointsEarned>=100000)return 4;if(totalPointsEarned>=10000)return 3;if(totalPointsEarned>=1000)return 2;if(totalPointsEarned>=100)return 1;return 0;}
    
    // ä¿¡é ¼åº¦ãƒ¬ãƒ™ãƒ«ã¾ã§ã®å…¨ã‚»ãƒªãƒ•ã‚’å–å¾—ï¼ˆç´¯ç©ï¼‰
    function getCumulativeDialogues(dialogueObj, trustLevel) {
      const allDialogues = [];
      for (let i = 0; i <= trustLevel; i++) {
        if (dialogueObj[i]) {
          allDialogues.push(...dialogueObj[i]);
        }
      }
      return allDialogues;
    }

    const dialogues={common:{0:['â€¦é †èª¿ã ã­','â€¦ã„ã„æ„Ÿã˜ã ','â€¦ãã®èª¿å­'],1:['â€¦ãªã‹ãªã‹ã ã­','â€¦æ…£ã‚Œã¦ããŸã¿ãŸã„ã ','â€¦æ‚ªããªã„'],2:['â€¦ã‚ãªãŸã‚‚æ¿ã«ã¤ã„ã¦ããŸã­','â€¦ã„ã„ãƒšãƒ¼ã‚¹ã ','â€¦ã“ã“ã‚’æ˜ã‚ã†ã‹ï¼Ÿ'],3:['â€¦ã•ã™ãŒã ã­','â€¦ã‚ãªãŸã¨ãªã‚‰æ¥½ã—ã„ã‚ˆ','â€¦ãã†ã ã­'],4:['â€¦é ¼ã‚Šã«ãªã‚‹ã‚ˆ','â€¦ã‚ãªãŸãŒã„ã¦ãã‚Œã¦åŠ©ã‹ã‚‹','â€¦ç™ºæ˜ã®ç›¸æ£’ã¯ã‚ãªãŸã ã‚ˆ'],5:['â€¦ã‚ãªãŸã¨ä¸€ç·’ã ã‹ã‚‰é ‘å¼µã‚Œã‚‹ãª','â€¦ã“ã‚Œã¯ãªã‚“ã ã‚ã†ï¼Ÿ']},rare:{0:['â€¦ã‚ã‚ã€ã„ã„ã‚‚ã®ã‹ã‚‚ã—ã‚Œãªã„','â€¦ã“ã‚Œã¯è²´é‡ã ã­','â€¦ä¸Šæ‰‹ã ã­'],1:['â€¦ãªã‹ãªã‹ã®ç™ºè¦‹ã ','â€¦ã‚»ãƒ³ã‚¹ãŒã„ã„ã­','â€¦æœŸå¾…ã§ããã†ã '],2:['â€¦ç´ æ™´ã‚‰ã—ã„ï¼','â€¦ã‚ãªãŸã®ç›®ã¯ç¢ºã‹ã ','â€¦ã•ã™ãŒã ã‚ˆ'],3:['â€¦ã‚„ã£ãŸï¼','â€¦ã‚ãªãŸã¨ãªã‚‰ä½•ã§ã‚‚è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ã‹ã‚‚','â€¦è½ã¡ç€ã„ã¦ã„ã“ã†'],4:['â€¦ä¿¡ã˜ã‚‰ã‚Œãªã„ã€ã¾ãŸè¦‹ã¤ã‘ãŸ','â€¦ã‚‚ã£ã¨ã„ã‘ã‚‹ã‹ãªï¼Ÿ','â€¦åœŸã®åŒ‚ã„ã€è½ã¡ç€ãã­'],5:['â€¦ã‚‚ã£ã¨æ˜ã£ã¦ã¿ã‚ˆã†ã‹ï¼Ÿ','â€¦éå»ã‚’æ˜ã‚‹ã£ã¦ã€ä¸æ€è­°ãªæ°—åˆ†ã ã­','â€¦â€¦ã†ã‚“ã€ã„ã„éŸ³']},epic:{0:['â€¦é¢¨ãŒæ°—æŒã¡ã„ã„ãª','â€¦ã‚†ã£ãã‚Šã‚„ã‚ã†','â€¦æ­´å²çš„ãªç™ºè¦‹ã ã­'],1:['â€¦ãƒ©ãƒ³ã‚¿ãƒ³ã®ç¯ã‚ŠãŒå¥½ããªã‚“ã ','â€¦çŸ³ã®ä¸‹ã«ã€çœ ã£ã¦ã‚‹ã‹ã‚‚ã—ã‚Œãªã„','â€¦ã‚ãªãŸã®å‹˜ã€å½“ãŸã£ãŸã­'],2:['â€¦ç´ æ™´ã‚‰ã—ã„ï¼æ„Ÿå‹•ã—ãŸ','ã“ã‚Œã¯â€¦â€¦ã™ã”ã„ã€‚å½¢ãŒå´©ã‚Œã¦ã„ãªã„','â€¦å†™çœŸã€ä¸€ç·’ã«æ’®ã‚ã†ã‹ï¼Ÿ'],3:['â€¦æœ¬å½“ã«ã€å­˜åœ¨ã—ãŸã‚“ã ã­','â€¦ä¸€ç·’ã«è¦‹ã¤ã‘ã‚‰ã‚Œã¦å¬‰ã—ã„','â€¦ç«ã‚’ä½¿ã£ãŸç—•è·¡ãŒã‚ã‚‹ã€æš®ã‚‰ã—ã®è·¡ã ã­'],4:['â€¦ç¶ºéº—ã ã­â€¦','â€¦ç©ºæ°—ãŒå°‘ã—é•ã†','â€¦ã‚ãªãŸã®åŠªåŠ›ã€ã¡ã‚ƒã‚“ã¨è¦‹ã¦ã‚‹ã‚ˆ'],5:['â€¦ã‚ãªãŸãŒã„ã¦ãã‚Œã¦æœ¬å½“ã«è‰¯ã‹ã£ãŸ','â€¦æ€ªæˆ‘ã«æ°—ã‚’ä»˜ã‘ã¦']},legendary:{0:['â€¦ä½•åƒå¹´ã‚‚å‰ã®ç©ºæ°—ã‚’å¸ã£ã¦ã‚‹æ°—ãŒã™ã‚‹','â€¦ã‚ãã‚ãã™ã‚‹ã­','â€¦ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚‚ãªã‚‹ã‚“ã '],1:['â€¦ã“ã‚Œã¯ã™ã”ã„','â€¦ã“ã‚“ã©ãƒ©ã‚¸ã‚ªã§è©±ã—ãŸã„ãª'],2:['â€¦ä¸æ€è­°ãªå½¢ã ','â€¦é‡‘å±ã®å…‰æ²¢ãŒæ®‹ã£ã¦ã‚‹','â€¦ã—ã°ã‚‰ãã€éŸ³ã‚’èã„ã¦ã¿ã‚ˆã†ã‹'],3:['â€¦ã‚ã‚ŠãŒã¨ã†â€¦æœ¬å½“ã«','â€¦ã“ã®åœ°å±¤ã€å¤ã„ãª','â€¦ã‚¹ã‚³ãƒƒãƒ—ã‚ˆã‚Šã‚‚ãƒ–ãƒ©ã‚·ã‚’ä½¿ã£ã¦ã¿ã¦'],4:['â€¦ã‚ãªãŸãŒã„ãªãã‚ƒã“ã“ã¾ã§æ¥ã‚Œãªã‹ã£ãŸ','â€¦ã•ã‚ã€æ´ã¾ã£ã¦'],5:['â€¦æ™‚ä»£ã‚’è¶…ãˆã¦ã€å½¢ãŒã“ã†ã—ã¦æ®‹ã‚‹ã£ã¦ã™ã”ã„ã­','â€¦ä½•ã‹åŸ‹ã¾ã£ã¦ã„ãã†','â€¦ã»ã‚‰ã€ä¸€ç·’ã«æ¥ã¦']},dig:{0:['â€¦ã•ã‚ã€æ˜ã‚ã†','â€¦ã“ã“ã«ä½•ã‹ã‚ã‚Šãã†ã ','â€¦æœŸå¾…ãŒé«˜ã¾ã‚‹ã­','â€¦ã“ã‚“ãªæ‰€ã¾ã§æ¥ãŸã‚‰ã€èŒ¨ã«å±ã‚‰ã‚Œã¡ã‚ƒã†ã‹ã‚‚','â€¦æ—¥å’Œãã‚“ã«é›»è©±ã—ã‚ˆã†ã‹ãª','â€¦ã‚¸ãƒ¥ãƒ³ã‚‚é€£ã‚Œã¦ããŸã‚‰æ¥½ã—ã‚“ã§ãã‚ŒãŸã‹ãª'],1:['â€¦ä»Šæ—¥ã‚‚é ‘å¼µã‚ã†','â€¦ã„ã„äºˆæ„ŸãŒã™ã‚‹','â€¦ä¸€ç·’ã«æ¢ãã†'],2:['â€¦ã‚ãªãŸã¨ãªã‚‰æ¥½ã—ã„ã‚ˆ','â€¦ä½•ãŒå‡ºã¦ãã‚‹ã‹ãª','â€¦ã‚ãã‚ãã™ã‚‹ã­'],3:['â€¦ä»Šæ—¥ã‚‚ä¸€ç·’ã ã­','â€¦ã‚ãªãŸã¨ã„ã‚‹ã¨è½ã¡ç€ã','â€¦æ¥½ã—ã¿ã '],4:['â€¦èª°ãŒã“ã‚Œã‚’ä½œã£ãŸã‚“ã ã‚ã†ã€‚æƒ³åƒã™ã‚‹ã¨æ¥½ã—ã„ã­','â€¦æ¨¡æ§˜ãŒæ®‹ã£ã¦ã‚‹ã€‚çã—ã„'],5:['â€¦ãã“ã€å´©ã‚Œãªã„ã‹ãªï¼Ÿæ°—ã‚’ã¤ã‘ã¦','â€¦ç™ºæ˜ã¯é™ã‘ã•ã®ä¸­ã§ã“ãã€é›†ä¸­ã§ãã‚‹ã­']}};

    function showDialogue(text){dialogueEl.textContent=text;}
    function maybeShowDialogue(rarity){const baseChance=100,reduction=totalDigs/20;const chance=Math.max(5,baseChance-reduction);if(Math.random()*100<chance){const trustLevel=getTrustLevel();const categoryDialogues=dialogues[rarity];const list=categoryDialogues?getCumulativeDialogues(categoryDialogues,trustLevel):getCumulativeDialogues(dialogues.common,trustLevel);showDialogue(list[Math.floor(Math.random()*list.length)]);}}

    function toast(msg,ms=1800){const t=document.createElement('div');t.className='toast';t.textContent=msg;document.body.appendChild(t);setTimeout(()=>t.remove(),ms);}
    function renderAchievements(){achievementsContainerEl.innerHTML='';achievementsDef.forEach(a=>{const st=achievementsState[a.id];const el=document.createElement('div');el.className='ach-item '+(st.unlocked?'unlocked':'');el.innerHTML=`<div class="ach-left"><span class="ach-badge">${st.unlocked?'ğŸ…':'ğŸ”’'}</span><div><div class="ach-name">${a.name}</div><div class="ach-desc">${a.desc}</div></div></div><div style="font-size:.65rem; color:#ffe082;">${st.unlocked?(st.date||''):''}</div>`;achievementsContainerEl.appendChild(el);});}
    function unlockAchievement(id){const st=achievementsState[id];if(!st||st.unlocked)return;st.unlocked=true;st.date=new Date().toLocaleString();renderAchievements();toast(`ğŸ† å®Ÿç¸¾è§£é™¤: ${achievementsDef.find(a=>a.id===id)?.name||id}`);saveGame();}

    function checkCollectionAchievements(){
      Object.entries(fields).forEach(([fieldId,field])=>{
        // ãã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å…¨ã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—
        const allArtifacts=[];
        ['common','rare','epic','legendary'].forEach(rarity=>{
          field.artifacts[rarity].forEach(artifact=>{
            allArtifacts.push(`${fieldId}_${rarity}_${artifact.name}`);
          });
        });
        
        // ãã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§å®Ÿéš›ã«ç™ºè¦‹ã—ãŸã‚¢ã‚¤ãƒ†ãƒ æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
        const collectedCount=allArtifacts.filter(key=>collection[key]&&collection[key].count>0).length;
        
        if(collectedCount>=allArtifacts.length)unlockAchievement('complete_'+fieldId);
      });
      
      // å…¨ä½“ãƒã‚§ãƒƒã‚¯
      const allPossibleKeys=[];
      Object.entries(fields).forEach(([fieldId,field])=>{
        ['common','rare','epic','legendary'].forEach(rarity=>{
          field.artifacts[rarity].forEach(artifact=>{
            allPossibleKeys.push(`${fieldId}_${rarity}_${artifact.name}`);
          });
        });
      });
      
      const totalCollectedCount=allPossibleKeys.filter(key=>collection[key]&&collection[key].count>0).length;
      
      if(totalCollectedCount>=allPossibleKeys.length)unlockAchievement('complete_all');
    }

    function findArtifact(){const baseRand=Math.random()*100;const commonThreshold=Math.max(20,80-rareBonus);let rarity,list;const field=fields[currentField];if(baseRand>99.99){rarity='legendary';list=field.artifacts.legendary;}else if(baseRand>95){rarity='epic';list=field.artifacts.epic;}else if(baseRand>commonThreshold){rarity='rare';list=field.artifacts.rare;}else{rarity='common';list=field.artifacts.common;}const artifact=list[Math.floor(Math.random()*list.length)];const key=`${currentField}_${rarity}_${artifact.name}`;if(!collection[key])collection[key]={...artifact,rarity,field:field.name,fieldId:currentField,count:0};collection[key].count++;foundItemEl.textContent=`${artifact.emoji} ${artifact.name} ã‚’ç™ºè¦‹ï¼`;foundItemEl.className=`found-item rarity-${rarity}`;foundItemEl.style.visibility='visible';setTimeout(()=>foundItemEl.style.visibility='hidden',2000);maybeShowDialogue(rarity);const pointValues={common:1,rare:6,epic:22,legendary:110};addPoints(pointValues[rarity]);if(rarity==='rare')unlockAchievement('first_rare');if(rarity==='epic')unlockAchievement('first_epic');if(rarity==='legendary')unlockAchievement('first_legend');updateDisplay();updateCollection();checkCollectionAchievements();}

    function updateCharacterPosition(){
      characterEl.style.left=`${charX}%`;
      characterEl.style.top=`${charY}%`;
      characterEl.style.transform='translate(-50%, -50%)';
      
      // ç§»å‹•æ–¹å‘ã«å¿œã˜ã¦å·¦å³åè»¢ï¼ˆç”»åƒã«é©ç”¨ï¼‰
      if (charX !== prevCharX) {
        const direction = charX > prevCharX ? 1 : -1; // å³ã«ç§»å‹•=1, å·¦ã«ç§»å‹•=-1
        charSpriteEl.style.transform = `scaleX(${direction})`;
        prevCharX = charX;
      }
    }
    
    /*** ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ ***/
    let currentSprite = 'idle';
    let blinkInterval = null;
    
    function setSprite(spriteName) {
      if (characterImages[currentField] && characterImages[currentField][spriteName]) {
        charSpriteEl.src = characterImages[currentField][spriteName];
        currentSprite = spriteName;
      }
    }
    
function startBlinkAnimation() {
  if (blinkInterval) clearInterval(blinkInterval);

  blinkInterval = setInterval(() => {
    if (currentSprite === 'idle' && !isDigging) {
      // ã¾ã°ãŸã
      setSprite('blink');
      setTimeout(() => {
        if (currentSprite === 'blink') setSprite('idle');
      }, 140); // 0.14ç§’ã¾ã°ãŸãï¼ˆ100â†’140ï¼‰
    }
  }, 2000 + Math.random() * 3000); // 3.2ã€œ6.8ç§’ã”ã¨
}

    
    function playDigAnimation() {
      setSprite('digUp');
      setTimeout(() => {
        setSprite('digDown');
        // idleæˆ»ã‚Šã¯digé–¢æ•°å´ã§ç®¡ç†ã™ã‚‹ãŸã‚ã€ã“ã“ã§ã¯è¡Œã‚ãªã„
      }, 200);
    }
    function moveCharacterTo(targetX,targetY,callback){
      isDigging=true;
      charX=targetX;
      charY=targetY;
      
      characterEl.classList.add('moving');
      updateCharacterPosition();
      
      setTimeout(()=>{
        characterEl.classList.remove('moving');
        if(callback)callback();
        setTimeout(()=>{isDigging=false;},400);
      },500);
    }
    function startWandering(){if(wanderInterval)clearInterval(wanderInterval);wanderInterval=setInterval(()=>{if(!isDigging){const newX=20+Math.random()*60;const newY=30+Math.random()*50;charX=newX;charY=newY;updateCharacterPosition();}},3000);}

    function dig(amount=clickPower,x=null,y=null){
      addPoints(amount);
      totalDigs=Math.floor(totalDigs)+1;
      
      // é€£æ‰“æ¤œçŸ¥
      const now = Date.now();
      const isRapidFire = (now - lastDigTime) < 100; // 100msä»¥å†…ãªã‚‰é€£æ‰“
      lastDigTime = now;
      
      if(x!==null&&y!==null){
        playDigSound();
        playDigAnimation();
      }
      
      if(totalDigs===1)unlockAchievement('first_dig');
      if(totalDigs>=100)unlockAchievement('dig_100');
      
      characterEl.classList.add('digging');
      
      // æ—¢å­˜ã®idleã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ã‚¯ãƒªã‚¢
      if(idleTimeout) clearTimeout(idleTimeout);
      
      // é€£æ‰“æ™‚ã¯digã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒã€é€šå¸¸æ™‚ã®ã¿idleçŠ¶æ…‹ã«æˆ»ã‚‹
      idleTimeout = setTimeout(()=>{
        characterEl.classList.remove('digging');
        setSprite('idle');
      }, isRapidFire ? 100 : 200);
      
      if(x!==null&&y!==null){
        const hole=document.createElement('div');
        hole.className='dig-hole';
        hole.style.left=x+'px';
        hole.style.top=y+'px';
        excavationAreaEl.appendChild(hole);
        setTimeout(()=>hole.remove(),2000);
        
        for(let i=0;i<5;i++){
          const fx=document.createElement('div');
          fx.className='dig-effect';
          fx.textContent='ğŸ’¨';
          fx.style.left=(x+Math.random()*40-20)+'px';
          fx.style.top=(y+Math.random()*40-20)+'px';
          excavationAreaEl.appendChild(fx);
          setTimeout(()=>fx.remove(),800);
        }
      }
      
      if(amount>=1){
        const eff=document.createElement('div');
        eff.className='click-effect';
        eff.textContent=`+${Math.floor(amount)}`;
        const rect=excavationAreaEl.getBoundingClientRect();
        eff.style.left=(x??(rect.width*0.5))+'px';
        eff.style.top=(y??(rect.height*0.7))+'px';
        excavationAreaEl.appendChild(eff);
        setTimeout(()=>eff.remove(),1000);
      }
      
      if(Math.random()<0.2)findArtifact();
      else if(Math.random()<0.1)maybeShowDialogue('dig');
      updateDisplay();
    }

    function updateDisplay(){pointsEl.textContent=Math.floor(points);clickPowerEl.textContent=clickPower;autoPowerEl.textContent=autoPower.toFixed(1);totalDigsEl.textContent=Math.floor(totalDigs);totalEarnedEl.textContent=Math.floor(totalPointsEarned);}

    function spawnGoldenArtifact(){if(goldenArtifactActive)return;goldenArtifactActive=true;const golden=document.createElement('div');golden.className='golden-artifact';golden.textContent='ğŸ«';golden.style.left=(Math.random()*70+15)+'%';golden.style.top=(Math.random()*50+30)+'%';golden.addEventListener('click',(e)=>{e.stopPropagation();playGoldenSound();const bonus=Math.floor(points*0.08+clickPower*12);addPoints(bonus);const effect=document.createElement('div');effect.className='click-effect';effect.textContent=`+${bonus} ğŸ«`;effect.style.left=golden.style.left;effect.style.top=golden.style.top;effect.style.position='absolute';effect.style.fontSize='1.5rem';effect.style.color='#ffd700';excavationAreaEl.appendChild(effect);setTimeout(()=>effect.remove(),1000);showDialogue('â€¦ã™ã”ã„ç™ºè¦‹ã ï¼');golden.remove();goldenArtifactActive=false;updateDisplay();scheduleGoldenArtifact();checkEarningsAchievements();});excavationAreaEl.appendChild(golden);setTimeout(()=>{if(golden.parentElement){golden.remove();goldenArtifactActive=false;scheduleGoldenArtifact();}},10000);}
    function scheduleGoldenArtifact(){setTimeout(()=>spawnGoldenArtifact(),Math.random()*90000+30000);}

    function getUpgradeCost(up){const owned=upgrades[up.id]||0;return Math.floor(up.baseCost*Math.pow(up.costMultiplier,owned));}
    function buyUpgrade(up){const cost=getUpgradeCost(up);if(points>=cost){spendPoints(cost);upgrades[up.id]=(upgrades[up.id]||0)+1;up.effect();playPurchaseSound();updateDisplay();updateShop();const trustLevel=getTrustLevel();const purchaseDialogues=[['â€¦è‰¯ã„é¸æŠã ','â€¦ãã‚Œã§ã„ã„','â€¦ã†ã‚“ã€ã„ã„ã­'],['â€¦ãƒŠã‚¤ã‚¹åˆ¤æ–­','â€¦è³¢ã„é¸æŠã ','â€¦ã•ã™ãŒã ã­'],['â€¦ç´ æ™´ã‚‰ã—ã„åˆ¤æ–­ã ','â€¦å®Œç’§ã ã‚ˆ','â€¦ä¿¡é ¼ã—ã¦ã‚‹ã‚ˆ'],['â€¦ã‚ãªãŸã®åˆ¤æ–­ã¯æœ€é«˜ã ','â€¦ã„ã¤ã‚‚åŠ©ã‹ã‚‹','â€¦ã•ã™ãŒç›¸æ£’ã '],['â€¦ã‚ãªãŸãŒã„ã¦ãã‚Œã¦å¿ƒå¼·ã„','â€¦æœ¬å½“ã«é ¼ã‚Šã«ãªã‚‹','â€¦æœ€é«˜ã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã '],['â€¦ã‚ãªãŸã¯ç§ã®å¸Œæœ›ã ','â€¦ã„ã¤ã‚‚ã‚ã‚ŠãŒã¨ã†','â€¦ã‚ãªãŸã¨ä¸€ç·’ãªã‚‰ä½•ã§ã‚‚ã§ãã‚‹']];const allDialogues=getCumulativeDialogues(purchaseDialogues,trustLevel);showDialogue(allDialogues[Math.floor(Math.random()*allDialogues.length)]);checkEarningsAchievements();}}
    function updateShop(){if(shopContainerEl.children.length===0){upgradeData.forEach((up,idx)=>{const item=document.createElement('div');item.className='shop-item';item.dataset.upgradeId=up.id;item.dataset.index=idx;item.dataset.lastCount='0';item.innerHTML=`<div class="shop-item-name">${up.name}</div><div class="shop-item-desc">${up.desc}</div><div class="shop-item-cost">ã‚³ã‚¹ãƒˆ: <span class="cost-value">0</span> pt</div><div class="shop-item-owned">æ‰€æŒ: <span class="owned-value">0</span></div><div class="shop-upgrade-icons"></div>`;item.addEventListener('click',function(){if(!this.classList.contains('disabled'))buyUpgrade(up);});shopContainerEl.appendChild(item);});}upgradeData.forEach((up,idx)=>{const cost=getUpgradeCost(up),can=points>=cost;const el=shopContainerEl.children[idx];if(!el)return;el.querySelector('.cost-value').textContent=cost;el.querySelector('.owned-value').textContent=upgrades[up.id]||0;if(can)el.classList.remove('disabled');else el.classList.add('disabled');const icons=el.querySelector('.shop-upgrade-icons');const cnt=upgrades[up.id]||0;const lastCount=parseInt(el.dataset.lastCount||'0');if(cnt!==lastCount){el.dataset.lastCount=cnt.toString();icons.innerHTML='';for(let i=0;i<Math.min(cnt,20);i++){const s=document.createElement('span');s.className='shop-upgrade-icon';s.textContent=up.icon;icons.appendChild(s);}if(cnt>20){const t=document.createElement('span');t.className='count-text';t.style.cssText='font-size:.7rem; color:#81c784; margin-left:.25rem;';t.textContent=`Ã—${cnt}`;icons.appendChild(t);}}});}

    function updateCollection(){currentTab==='list'?updateCollectionList():updateCollectionGallery();}
    function updateCollectionList(){collectionContainerEl.innerHTML='';const arr=Object.values(collection).sort((a,b)=>({common:0,rare:1,epic:2,legendary:3}[b.rarity]-{common:0,rare:1,epic:2,legendary:3}[a.rarity]));arr.forEach(item=>{const el=document.createElement('div');el.className=`collection-item ${item.rarity}`;el.innerHTML=`<div><span class="item-name">${item.emoji} ${item.name}</span><div style="font-size:.65rem; color:#ffe082;">${item.field}</div></div><span class="item-count">Ã—${item.count}</span>`;collectionContainerEl.appendChild(el);});if(arr.length===0){collectionContainerEl.innerHTML='<div style="text-align:center; color:#ffe082;">ã¾ã ä½•ã‚‚ç™ºè¦‹ã—ã¦ã„ãªã„</div>';}}
    function updateCollectionGallery(){collectionContainerEl.innerHTML='';Object.entries(fields).forEach(([fieldId,field])=>{const header=document.createElement('div');header.className='gallery-stage-header'+(field.unlocked?'':' locked');header.textContent=field.unlocked?`${field.emoji} ${field.name}`:`ğŸ”’ ${field.name}ï¼ˆ${field.unlockCost} ptã§è§£ç¦ï¼‰`;collectionContainerEl.appendChild(header);const grid=document.createElement('div');grid.className='gallery-grid';['common','rare','epic','legendary'].forEach(rarity=>{field.artifacts[rarity].forEach(artifact=>{const key=`${fieldId}_${rarity}_${artifact.name}`;const owned=collection[key]?.count>0;const el=document.createElement('div');el.className=`gallery-item ${rarity} ${owned?'':'locked'}`;el.innerHTML=`<div class="gallery-emoji">${owned?artifact.emoji:'â“'}</div><div class="gallery-name">${owned?artifact.name:'ï¼Ÿï¼Ÿï¼Ÿ'}</div><div class="gallery-count">${owned?`Ã—${collection[key].count}`:''}</div>`;grid.appendChild(el);});});collectionContainerEl.appendChild(grid);});}

    listTabEl.addEventListener('click',()=>{currentTab='list';listTabEl.classList.add('active');galleryTabEl.classList.remove('active');updateCollection();});
    galleryTabEl.addEventListener('click',()=>{currentTab='gallery';galleryTabEl.classList.add('active');listTabEl.classList.remove('active');updateCollection();});

    function switchField(id){currentField=id;const f=fields[id];document.body.setAttribute('data-field',id);document.body.style.background=f.bgGradient;fieldBackgroundEl.style.background=f.fieldBg;const fieldNameEl=document.getElementById('current-field-name');fieldNameEl.style.color=f.textColor;dialogueEl.style.color=f.textColor;foundItemEl.style.color=f.textColor;fieldNameEl.textContent=`${f.emoji} ${f.name}`;const trustLevel=getTrustLevel();const arrivalDialogues=[[`â€¦${f.name}ã«åˆ°ç€ã—ãŸ`],[`â€¦${f.name}ã ã­`],[`â€¦${f.name}ã‹ã€æ¥½ã—ã¿ã `],[`â€¦${f.name}ã€ä¸€ç·’ã«æ¢ç´¢ã—ã‚ˆã†`],[`â€¦${f.name}ã€ã‚ãªãŸã¨ãªã‚‰æ€–ããªã„`],[`â€¦${f.name}ã€ã‚ãªãŸã¨ä¸€ç·’ã§å¬‰ã—ã„`]];const allArrival=getCumulativeDialogues(arrivalDialogues,trustLevel);showDialogue(allArrival[Math.floor(Math.random()*allArrival.length)]);setSprite('idle');updateFields();updateCollection();}

    let fieldsInitialized=false;
    let lastUnlockedCount=0;
    
    function updateFields(){
      const container=document.getElementById('field-container');
      
      if(!fieldsInitialized){
        container.innerHTML='';
        Object.entries(fields).forEach(([id,f])=>{
          const btn=document.createElement('button');
          btn.dataset.fieldId=id;
          btn.style.cssText=`padding:.4rem; border-radius:.4rem; border:2px solid transparent; background:rgba(255,255,255,.15); color:#ffecb3; cursor:pointer; transition:all .2s; font-size:.75rem; display:flex; justify-content:space-between; align-items:center;`;
          
          btn.addEventListener('click',function(){
            const fid=this.dataset.fieldId,fld=fields[fid];
            if(fld.unlocked){
              switchField(fid);
            }else if(points>=fld.unlockCost){
              spendPoints(fld.unlockCost);
              fld.unlocked=true;
              const trustLevel=getTrustLevel();
              const unlockDialogues=[[`â€¦${fld.name}ãŒè§£ç¦ã•ã‚ŒãŸã­`],[`â€¦${fld.name}ã‚’è§£ç¦ã—ãŸã‚ˆ`],[`â€¦${fld.name}ã€æ¥½ã—ã¿ã ã­`],[`â€¦${fld.name}ã€ä¸€ç·’ã«æ¢æ¤œã—ã‚ˆã†`],[`â€¦${fld.name}ã€ã‚ãªãŸã¨ãªã‚‰æ€–ããªã„`],[`â€¦${fld.name}ã€æ–°ã—ã„å†’é™ºã®å§‹ã¾ã‚Šã `]];
              const allUnlock=getCumulativeDialogues(unlockDialogues,trustLevel);
              showDialogue(allUnlock[Math.floor(Math.random()*allUnlock.length)]);
              
              // æ–°è¦ã‚¢ãƒ³ãƒ­ãƒƒã‚¯æ™‚ã®ã¿è‡ªå‹•åˆ‡æ›¿
              switchField(fid);
              
              updateDisplay();
              updateFields();
              
              const unlockedCount=Object.values(fields).filter(v=>v.unlocked).length;
              if(unlockedCount>=2)unlockAchievement('unlock_2');
              if(unlockedCount===Object.keys(fields).length)unlockAchievement('unlock_all');
            }
          });
          
          btn.addEventListener('mouseenter',function(){
            const fid=this.dataset.fieldId;
            if(fid!==currentField&&fields[fid].unlocked)this.style.background='rgba(255,255,255,.25)';
          });
          
          btn.addEventListener('mouseleave',function(){
            const fid=this.dataset.fieldId;
            if(fid!==currentField&&fields[fid].unlocked)this.style.background='rgba(255,255,255,.15)';
          });
          
          container.appendChild(btn);
        });
        fieldsInitialized=true;
      }
      
      // ç¾åœ¨ã®ã‚¢ãƒ³ãƒ­ãƒƒã‚¯æ•°ã‚’è¨˜éŒ²
      const currentUnlockedCount = Object.values(fields).filter(f=>f.unlocked).length;
      lastUnlockedCount = currentUnlockedCount;
      
      Object.entries(fields).forEach(([id,f],idx)=>{
        const btn=container.children[idx];
        if(!btn)return;
        const isCurrent=id===currentField,canUnlock=!f.unlocked&&points>=f.unlockCost;
        
        if(f.unlocked){
          btn.innerHTML=`<span>${f.emoji} ${f.name}</span>${isCurrent?'<span>âœ“</span>':''}`;
          btn.style.color='#ffecb3';
          btn.style.cursor='pointer';
          btn.style.opacity='1';
          btn.style.borderColor=isCurrent?'#ffeb3b':'transparent';
          btn.style.background='rgba(255,255,255,.15)';
        }else{
          btn.innerHTML=`<span>ğŸ”’ ${f.name}</span><span style="font-size:.75rem;">${f.unlockCost} pt</span>`;
          if(canUnlock){
            btn.style.cursor='pointer';
            btn.style.color='#ffecb3';
            btn.style.background='rgba(255,235,59,.2)';
            btn.style.borderColor='#ffeb3b';
            btn.style.opacity='1';
          }else{
            btn.style.cursor='not-allowed';
            btn.style.color='#999';
            btn.style.background='rgba(255,255,255,.05)';
            btn.style.borderColor='#666';
            btn.style.opacity='.5';
          }
        }
      });
    }

    excavationAreaEl.addEventListener('click',(e)=>{const rect=excavationAreaEl.getBoundingClientRect();const x=e.clientX-rect.left;const y=e.clientY-rect.top;const targetX=(x/rect.width)*100;const targetY=(y/rect.height)*100;moveCharacterTo(targetX,targetY,()=>{dig(clickPower,x,y);});});
    document.getElementById('reset-btn').addEventListener('click',()=>{if(confirm('æœ¬å½“ã«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')){localStorage.removeItem('excavationClicker_save');location.reload();}});

    setInterval(()=>{if(autoPower>0)dig(autoPower/10);},100);
    setInterval(()=>{updateShop();updateFields();},500);

    function saveGame(){
      const saveData={
        points,
        totalPointsEarned,
        clickPower,
        autoPower,
        totalDigs:Math.floor(totalDigs),
        rareBonus,
        currentField,
        currentTab,
        upgrades,
        collection,
        fields:Object.fromEntries(Object.entries(fields).map(([id,f])=>[id,{unlocked:f.unlocked}])),
        achievements:achievementsState
      };
      localStorage.setItem('excavationClicker_save',JSON.stringify(saveData));
    }
    function loadGame(){
      const s=localStorage.getItem('excavationClicker_save');
      if(!s)return false;
      try{
        const d=JSON.parse(s);
        points=d.points??0;
        totalPointsEarned=d.totalPointsEarned??0;
        clickPower=d.clickPower??1;
        autoPower=d.autoPower??0;
        totalDigs=Math.floor(d.totalDigs??0);
        rareBonus=d.rareBonus??0;
        currentField=d.currentField??'grassland';
        currentTab=d.currentTab??'list';
        if(d.upgrades)Object.assign(upgrades,d.upgrades);
        if(d.collection)Object.assign(collection,d.collection);
        if(d.fields){
          Object.entries(d.fields).forEach(([id,val])=>{
            if(fields[id]&&val&&typeof val==='object'){
              fields[id].unlocked=!!val.unlocked;
            }
          });
        }
        if(d.achievements)Object.keys(achievementsState).forEach(id=>{
          if(d.achievements[id])achievementsState[id]=d.achievements[id];
        });
        
        // ãƒ­ãƒ¼ãƒ‰å¾Œã®å®Ÿç¸¾UIåæ˜ ã‚’ç¢ºå®Ÿã«
        renderAchievements();
        
        return true;
      }catch(e){
        console.error('ãƒ­ãƒ¼ãƒ‰å¤±æ•—',e);
        return false;
      }
    }
    setInterval(saveGame,5000);
    window.addEventListener('beforeunload',saveGame);

    const loaded=loadGame();
    if(currentTab==='gallery'){
      listTabEl.classList.remove('active');
      galleryTabEl.classList.add('active');
    }
    
    updateDisplay();
    updateShop();
    updateCollection();
    renderAchievements();
    updateFields();
    switchField(currentField);

    const trustLevel=getTrustLevel();
    if(loaded){
      const welcomeBackDialogues=[['â€¦ãŠã‹ãˆã‚Šã€ç¶šãã‹ã‚‰å§‹ã‚ã‚ˆã†'],['â€¦ã¾ãŸä¼šãˆãŸã­'],['â€¦å¾…ã£ã¦ãŸã‚ˆ'],['â€¦ã¾ãŸä¸€ç·’ã ã­ã€å¬‰ã—ã„'],['â€¦ä¼šã„ãŸã‹ã£ãŸ'],['â€¦ã‚ãªãŸãŒæˆ»ã£ã¦ãã¦ãã‚Œã¦å¬‰ã—ã„']];
      const allWelcome=getCumulativeDialogues(welcomeBackDialogues,trustLevel);
      showDialogue(allWelcome[Math.floor(Math.random()*allWelcome.length)]);
    }else{
      const startDialogues=[['â€¦ã•ã‚ã€ç™ºæ˜ã‚’å§‹ã‚ã‚ˆã†'],['â€¦ã‚ˆã‚ã—ãé ¼ã‚€ã‚ˆ'],['â€¦ä¸€ç·’ã«é ‘å¼µã‚ã†'],['â€¦ã‚ãªãŸã¨ãªã‚‰æ¥½ã—ããªã‚Šãã†ã '],['â€¦ã‚ãªãŸã¨ä¸€ç·’ã§å¿ƒå¼·ã„'],['â€¦ä»Šæ—¥ã‚‚ã‚ˆã‚ã—ãã­']];
      const allStart=getCumulativeDialogues(startDialogues,trustLevel);
      showDialogue(allStart[Math.floor(Math.random()*allStart.length)]);
    }

    function checkEarningsAchievements(){if(totalPointsEarned>=1000)unlockAchievement('earn_1k');if(totalPointsEarned>=10000)unlockAchievement('earn_10k');if(totalPointsEarned>=50000)unlockAchievement('earn_50k');if(totalPointsEarned>=100000)unlockAchievement('earn_100k');if(totalPointsEarned>=500000)unlockAchievement('earn_500k');if(totalPointsEarned>=1000000)unlockAchievement('earn_1m');}
    checkEarningsAchievements();
    checkCollectionAchievements();
    const unlockedCount=Object.values(fields).filter(v=>v.unlocked).length;if(unlockedCount>=2)unlockAchievement('unlock_2');if(unlockedCount===Object.keys(fields).length)unlockAchievement('unlock_all');
    scheduleGoldenArtifact();

    updateCharacterPosition();
    startWandering();
    
    // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
    setSprite('idle');
    startBlinkAnimation();
  </script>
</body>
</html>
